Index: comctl32.spec
===================================================================
RCS file: /home/wine/wine/dlls/comctl32/comctl32.spec,v
retrieving revision 1.46
diff -u -r1.46 comctl32.spec
--- comctl32.spec	19 Oct 2004 22:59:59 -0000	1.46
+++ comctl32.spec	5 Dec 2004 22:48:09 -0000
@@ -106,13 +106,13 @@
 412 stdcall RemoveWindowSubclass(long ptr long)
 413 stdcall DefSubclassProc(long long long long)
 414 stdcall -noname MirrorIcon(ptr ptr)
-415 stdcall -noname DrawTextWrap(long wstr long ptr long) user32.DrawTextW
-416 stdcall -noname DrawTextExPrivWrap(long wstr long ptr long ptr) user32.DrawTextExW
-417 stdcall -noname ExtTextOutWrap(long long long long ptr wstr long ptr) gdi32.ExtTextOutW
-418 stdcall -noname GetCharWidthWrap(long long long long) gdi32.GetCharWidthW
-419 stdcall -noname GetTextExtentPointWrap(long wstr long ptr) gdi32.GetTextExtentPointW
-420 stdcall -noname GetTextExtentPoint32Wrap(long wstr long ptr) gdi32.GetTextExtentPoint32W
-421 stdcall -noname TextOutWrap(long long long wstr long) gdi32.TextOutW
+415 stdcall DrawTextWrap(long wstr long ptr long) user32.DrawTextW
+416 stdcall DrawTextExPrivWrap(long wstr long ptr long ptr) user32.DrawTextExW
+417 stdcall ExtTextOutWrap(long long long long ptr wstr long ptr) gdi32.ExtTextOutW
+418 stdcall GetCharWidthWrap(long long long long) gdi32.GetCharWidthW
+419 stdcall GetTextExtentPointWrap(long wstr long ptr) gdi32.GetTextExtentPointW
+420 stdcall GetTextExtentPoint32Wrap(long wstr long ptr) gdi32.GetTextExtentPoint32W
+421 stdcall TextOutWrap(long long long wstr long) gdi32.TextOutW
 
 # Functions imported by name
 
Index: commctrl.c
===================================================================
RCS file: /home/wine/wine/dlls/comctl32/commctrl.c,v
retrieving revision 1.88
diff -u -r1.88 commctrl.c
--- commctrl.c	19 Oct 2004 22:59:59 -0000	1.88
+++ commctrl.c	5 Dec 2004 22:48:09 -0000
@@ -482,7 +482,7 @@
         r.left += 3;
         if (style & SBT_RTLREADING)
 	    FIXME("Unsupported RTL style!\n");
-        DrawTextW (hdc, text, -1, &r, align|DT_VCENTER|DT_SINGLELINE);
+        DrawTextW (hdc, text, -1, &r, align|DT_VCENTER|DT_SINGLELINE|DT_NOPREFIX);
 	SetBkMode(hdc, oldbkmode);
     }
 }
Index: datetime.c
===================================================================
RCS file: /home/wine/wine/dlls/comctl32/datetime.c,v
retrieving revision 1.49
diff -u -r1.49 datetime.c
--- datetime.c	24 Nov 2004 18:28:31 -0000	1.49
+++ datetime.c	5 Dec 2004 22:48:10 -0000
@@ -814,10 +814,10 @@
 
     TRACE("Height=%ld, Width=%ld\n", infoPtr->rcClient.bottom, infoPtr->rcClient.right);
 
-    /* use DrawEdge to adjust the size of rcEdge to get rcDraw */
     memcpy((&infoPtr->rcDraw), (&infoPtr->rcClient), sizeof(infoPtr->rcDraw));
 
-    DrawEdge(NULL, &(infoPtr->rcDraw), EDGE_SUNKEN, BF_RECT | BF_ADJUST);
+    /* subract the size of the edge drawn by DrawEdge */
+    InflateRect(&infoPtr->rcDraw, -2, -2);
 
     /* set the size of the button that drops the calendar down */
     /* FIXME: account for style that allows button on left side */
Index: listview.c
===================================================================
RCS file: /home/wine/wine/dlls/comctl32/listview.c,v
retrieving revision 1.398
diff -u -r1.398 listview.c
--- listview.c	24 Nov 2004 18:28:31 -0000	1.398
+++ listview.c	5 Dec 2004 22:48:13 -0000
@@ -146,6 +146,7 @@
 #include <assert.h>
 #include <ctype.h>
 #include <string.h>
+#include <stddef.h>
 #include <stdlib.h>
 #include <stdarg.h>
 #include <stdio.h>
@@ -2033,7 +2034,8 @@
 		         infoPtr->iconSize.cy + ICON_BOTTOM_PADDING;
 	    Label.right = Label.left + labelSize.cx;
 	    Label.bottom = Label.top + infoPtr->nItemHeight;
-	    if (!oversizedBox && labelSize.cy > infoPtr->ntmHeight)
+	    if (!oversizedBox && labelSize.cy > infoPtr->ntmHeight &&
+	        infoPtr->ntmHeight)
 	    {
 		labelSize.cy = min(Box.bottom - Label.top, labelSize.cy);
 		labelSize.cy /= infoPtr->ntmHeight;
@@ -9522,7 +9524,8 @@
         hOldFont = SelectObject(hdc, infoPtr->hFont);
 
     /*Get String Length in pixels */
-    GetTextExtentPoint32W(hdc, text, lstrlenW(text), &sz);
+    if(!GetTextExtentPoint32W(hdc, text, lstrlenW(text), &sz))
+        sz.cx = 0;
 
     /*Add Extra spacing for the next character */
     GetTextMetricsW(hdc, &textMetric);
Index: rebar.c
===================================================================
RCS file: /home/wine/wine/dlls/comctl32/rebar.c,v
retrieving revision 1.100
diff -u -r1.100 rebar.c
--- rebar.c	24 Nov 2004 18:28:31 -0000	1.100
+++ rebar.c	5 Dec 2004 22:48:14 -0000
@@ -3786,10 +3786,10 @@
 	infoPtr->bands = NULL;
     }
 
-    DeleteObject (infoPtr->hcurArrow);
-    DeleteObject (infoPtr->hcurHorz);
-    DeleteObject (infoPtr->hcurVert);
-    DeleteObject (infoPtr->hcurDrag);
+    DestroyCursor (infoPtr->hcurArrow);
+    DestroyCursor (infoPtr->hcurHorz);
+    DestroyCursor (infoPtr->hcurVert);
+    DestroyCursor (infoPtr->hcurDrag);
     if(infoPtr->hDefaultFont) DeleteObject (infoPtr->hDefaultFont);
     SetWindowLongPtrW (infoPtr->hwndSelf, 0, 0);
 
Index: string.c
===================================================================
RCS file: /home/wine/wine/dlls/comctl32/string.c,v
retrieving revision 1.5
diff -u -r1.5 string.c
--- string.c	22 Sep 2004 19:10:27 -0000	1.5
+++ string.c	5 Dec 2004 22:48:15 -0000
@@ -264,7 +264,7 @@
 {
   TRACE("(%s,%s)\n", debugstr_w(lpszStr), debugstr_w(lpszSearch));
 
-  return COMCTL32_StrStrHelperW(lpszStr, lpszSearch, strncmpiW);
+  return COMCTL32_StrStrHelperW(lpszStr, lpszSearch, (int (*)(LPCWSTR,LPCWSTR,int)) wcsnicmp);
 }
 
 /**************************************************************************
@@ -513,7 +513,7 @@
 {
   TRACE("(%s,%s)\n", debugstr_w(lpszStr), debugstr_w(lpszSearch));
 
-  return COMCTL32_StrStrHelperW(lpszStr, lpszSearch, strncmpW);
+  return COMCTL32_StrStrHelperW(lpszStr, lpszSearch, (int (*)(LPCWSTR,LPCWSTR,int)) wcsncmp);
 }
 
 /*************************************************************************
Index: tooltips.c
===================================================================
RCS file: /home/wine/wine/dlls/comctl32/tooltips.c,v
retrieving revision 1.74
diff -u -r1.74 tooltips.c
--- tooltips.c	25 Oct 2004 21:44:50 -0000	1.74
+++ tooltips.c	5 Dec 2004 22:48:16 -0000
@@ -2836,7 +2836,7 @@
 TOOLTIPS_Unregister (void)
 {
     int i;
-    for (i = 0; i < TTI_ERROR+1; i++)
-        DeleteObject(hTooltipIcons[i]);
+    for (i = TTI_INFO; i <= TTI_ERROR; i++)
+        DestroyIcon(hTooltipIcons[i]);
     UnregisterClassW (TOOLTIPS_CLASSW, NULL);
 }
Index: treeview.c
===================================================================
RCS file: /home/wine/wine/dlls/comctl32/treeview.c,v
retrieving revision 1.158
diff -u -r1.158 treeview.c
--- treeview.c	21 Nov 2004 15:41:08 -0000	1.158
+++ treeview.c	5 Dec 2004 22:48:18 -0000
@@ -2329,7 +2329,7 @@
 	    SelectObject(hdc, hOldPen);
 	    DeleteObject(hNewPen);
 
-	    if (height < 16 || width < 16)
+	    if (height < 18 || width < 18)
 	    {
 	        MoveToEx(hdc, centerx - plussize + 1, centery, NULL);
 	        LineTo(hdc, centerx + plussize, centery);
Index: status.c
===================================================================
RCS file: /CVS/ReactOS/reactos/lib/comctl32/status.c,v
retrieving revision 1.7
diff -u -r1.7 status.c
--- status.c	5 Dec 2004 23:09:27 -0000	1.7
+++ status.c	14 Dec 2004 00:58:03 -0000
@@ -650,6 +650,7 @@
 {
     STATUSWINDOWPART *part=NULL;
     BOOL changed = FALSE;
+    WORD oldStyle;
 
     if (style & SBT_OWNERDRAW) {
          TRACE("part %d, text %p\n",nPart,text);
@@ -671,6 +672,7 @@
     if (part->style != style)
 	changed = TRUE;
 
+    oldStyle = part->style;
     part->style = style;
     if (style & SBT_OWNERDRAW) {
 	if (part->text == text)
@@ -694,7 +696,7 @@
 	/* check if text is unchanged -> no need to redraw */
 	if (text) {
 	    if (!changed && part->text && !lstrcmpW(ntext, part->text)) {
-		if (!isW) Free(ntext);
+		Free(ntext);
 		return TRUE;
 	    }
 	} else {
@@ -702,7 +704,7 @@
 		return TRUE;
 	}
 
-	if (part->text)
+	if (part->text && !(oldStyle & SBT_OWNERDRAW))
 	    Free (part->text);
 	part->text = ntext;
     }
