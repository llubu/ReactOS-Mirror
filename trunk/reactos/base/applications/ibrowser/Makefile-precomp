#
#  ROS Internet Web Browser
#
#  Makefile-precomp
#
#  MinGW Makefile with precompiled header support
#

CC = gcc
CXX = g++
LINK = g++

CFLAGS	= -DWIN32 -D_WIN32_IE=0x0600 -D_WIN32_WINNT=0x0501 -DWINVER=0x0500 -fexceptions -Wall -Wno-unused-value -I. -I$(EXPAT_INC)
RCFLAGS	= -DWIN32 -D__WINDRES__
LFLAGS	= -Wl,--subsystem,windows

ifdef DEBUG
CFLAGS	+= -D_DEBUG -g
RCFLAGS	+= -D_DEBUG
LFLAGS	+= -g
else
CFLAGS	+= -DNDEBUG -Os -march=pentium4
RCFLAGS	+= -DNDEBUG
LFLAGS	+= -s
endif

ifndef UNICODE
UNICODE = 1
endif

ifeq ($(UNICODE),1)
CFLAGS	+= -DUNICODE
# LFLAGS+= -Wl,--entry,_wWinMain@16
RCFLAGS += -DUNICODE
endif

CXXFLAGS = $(CFLAGS)

EXEC_SUFFIX = .exe
RES_SUFFIX = .coff

VPATH = utility

PROGRAM = ibrowser

TARGET = $(PROGRAM)$(EXEC_SUFFIX)

OBJECTS = \
	utility.o \
	window.o \
	ibrowser.o \
	webchild.o \
	mainframe.o \
	favorites.o \
	xmlstorage.o

LIBS = gdi32 comctl32 shell32 ole32 oleaut32 uuid

all: precomp.h.gch $(TARGET)

precomp.h.gch: *.h utility/*.h
	$(CXX) $(CFLAGS) precomp.h

$(TARGET): $(OBJECTS) $(PROGRAM)$(RES_SUFFIX) libexpat.dll
	$(LINK) $(LFLAGS) -o $@ $^ $(addprefix -l,$(LIBS)) $(addprefix -l,$(DELAYIMPORTS))

ibrowser$(RES_SUFFIX): $(PROGRAM)_intres.rc res/*.bmp res/*.ico
	windres $(RCFLAGS) -o $@ $(PROGRAM)_intres.rc

clean:
	rm -f $(TARGET) $(OBJECTS) $(PROGRAM)$(RES_SUFFIX) precomp.h.gch \
	utility/*.o
